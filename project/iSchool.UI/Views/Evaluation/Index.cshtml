@using iSchool.Organization.Appliaction.ViewModels
@using X.PagedList.Mvc.Core;
@using X.PagedList;
@using X.PagedList.Mvc.Common;
@using iSchool.Organization.Appliaction.Service.Evaluations;
@using iSchool.Infrastructure;
@using iSchool.Organization.Domain.Enum;
@model IPagedList<EvalItem>
@{
    ViewData["Title"] = "评测管理";
    ViewData["EvalId"] = null;

}
@section css{
    <link href="@(ViewBag.StaticFile)/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    @*<link href="~/css/jsselect/select.css" rel="stylesheet" />*@
    <style>
        .dataTables_paginate .pagination li.active span {
            background: #272c33;
            border-color: #272c33;
            color: #fff;
        }

        .typeahead {
            z-index: 8000;
        }

        .inline-form-control {
            display: inline-block;
            width: 100%;
            height: calc(1.5em + .75rem + 2px);
            padding: .375rem .75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: .25rem;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        }

        .a-href {
            cursor: pointer;
        }

        .sorting, .td-text-center {
            text-align: center;
        }

        .scale-img {
            overflow: hidden;
        }

            .scale-img img {
                width: 100%;
                height: 100%;
                -webkit-object-fit: cover;
                object-fit: cover;
                transition: .5s all linear;
                -ms-transition: .5s all linear; /* IE 9 */
                -moz-transition: .5s all linear; /* Firefox */
                -webkit-transition: .5s all linear; /* Safari 和 Chrome */
                -o-transition: .5s all linear; /* Opera */
                border: none;
            }

            .scale-img:hover img {
                transform: scale3d(1.1,1.1,1.1);
                -ms-transform: scale3d(1.1,1.1,1.1);
                -moz-transform: scale3d(1.1,1.1,1.1);
                -webkit-transform: scale3d(1.1,1.1,1.1);
                -o-transform: scale3d(1.1,1.1,1.1);
                border: none;
            }
    </style>

}
@*条件搜索*@
<form action="@(Url.Action("Index"))" method="get">
    <div class="card">
        <div class="card-body">
            <div class="row form-group">
                @if (false)
                {
                    @*科目*@
                    <div class="col-md-2">
                        <label class="form-control-label">科目</label>
                        <select name="Subject" id="Subject" class="form-control" asp-items="@ViewBag.SubjectList">
                            <option value="" disabled selected hidden>请选择</option>
                            <option value="0">所有</option>
                        </select>
                    </div>
                    @*关联课程*@
                    <div class="col-md-2">
                        <label class="form-control-label">关联课程</label>
                        <select name="CourseId" id="CourseId" class="form-control">
                            <option value="" disabled selected hidden>请选择</option>
                        </select>
                    </div>
                    @*纯文字图片*@
                    <div class="col-md-2">
                        <label class=" form-control-label">纯文字图片</label>
                        <select name="IsPlaintext" id="IsPlaintext" class="form-control">
                            <option value="" disabled selected hidden>请选择</option>
                            <option value="true">是</option>
                            <option value="false">否</option>
                        </select>
                    </div>
                }
                @*时间*@
                <div class="col-md-3">
                    <label class=" form-control-label">时间</label>
                    <div class="form-inline">
                        <input type="text" style="width: 120px;" value="" id="StartTime" name="StartTime" placeholder="请选择时间" class="form-control datetimepicker4">
                        <label class="form-control-label" style="margin-top:2%;">至</label>
                        <input type="text" style="width: 120px;" value="" id="EndTime" name="EndTime" placeholder="请选择时间" class="form-control datetimepicker4">
                    </div>
                </div>
                @*用户手机*@
                <div class="col-md-3">
                    <label class=" form-control-label">用户手机</label>
                    <input class="form-control" name="Mobile" id="Mobile" placeholder="输入内容" />
                </div>
                @*用户昵称*@
                <div class="col-md-3">
                    <label class=" form-control-label">用户昵称</label>
                    <input class="form-control" name="UserName" id="UserName" placeholder="输入内容" />
                </div>
            </div>
            <div class="row form-group">
                @*是否上架*@
                <div class="col-md-2">
                    <label class=" form-control-label">是否上架</label>
                    <select name="IsOnTheShelf" id="IsOnTheShelf" class="form-control">
                        <option value="" disabled selected hidden>请选择</option>
                        <option value="true">是</option>
                        <option value="false">否</option>
                    </select>
                </div>
                @*是否官方*@
                <div class="col-md-2">
                    <label class="form-control-label">是否官方</label>
                    <select name="IsOfficial" id="IsOfficial" class="form-control">
                        <option value="" disabled selected hidden>请选择</option>
                        <option value="true">是</option>
                        <option value="false">否</option>
                    </select>
                </div>
                @*筛选条件*@
                <div class="col-md-5">
                    <label class="form-control-label">筛选条件</label>
                    <div class="form-inline">
                        <select name="SearchField" id="SearchField" class="form-control">
                            <option value="" disabled selected hidden>请选择</option>
                            <option value="title">标题</option>
                            <option value="userid">作者</option>
                            <option value="content">正文</option>
                        </select>
                        <input class="form-control" name="SearchFieldValue" id="SearchFieldValue" placeholder="输入内容" />
                    </div>
                </div>
                @*查询*@
                <div class="col-md-1" style="padding-top:33px;">
                    <button id="search" class="btn btn-primary btn-sm" type="submit">查询</button>
                </div>
                @*新增*@
                <div class="col-md-1" style="padding-top:33px;">
                    <a class="btn btn-primary btn-sm" style="color: #fff;" href="@Url.Action("AddShow", new { queryJson = ViewBag.queryJson,page=ViewBag.page})">新增</a>
                </div>

            </div>
            <div class="row form-group">
                @*是否加精*@
                <div class="col-md-2">
                    <label class="form-control-label">是否加精</label>
                    <select name="Stick" id="Stick" class="form-control">
                        <option value="" disabled selected hidden>请选择</option>
                        <option value="true">是</option>
                        <option value="false">否</option>
                    </select>
                </div>
                @*审核状态*@
                <div class="col-md-2">
                    <label class="form-control-label">审核状态</label>
                    <select name="AuditStatus" id="AuditStatus" asp-items="@ViewBag.AuditStatusList" class="form-control">
                        <option value="-1">全部</option>
                    </select>
                </div>
                @*关联主体*@
                <div class="col-md-2">
                    <label class="form-control-label">关联主体</label>
                    <input class="form-control" name="RelatedBody" id="RelatedBody" placeholder="输入内容" />
                </div>
            </div>
        </div>
    </div>
</form>
<div class="card">
    <div class="card-header">评测列表</div>
    <div class="card-body">
        <div class="row">
            @*评测列表--表头*@
            <div class="col-sm-12">
                <table id="bootstrap-data-table-export" class="table table-striped table-bordered dataTable no-footer" role="grid" aria-describedby="bootstrap-data-table-export_info">
                    <thead>
                        <tr role="row" style="text-align:center;">
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending" @*style="width:60px;"*@>
                                序号
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending" @*style="width: 100px;"*@>
                                评测标题
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 100px;"*@>
                                封面图
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width:60px;"*@>
                                UV
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width:60px;"*@>
                                评论数
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width:60px;"*@>
                                点赞数
                            </th>
                            @if (false) 
                            {
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width:60px;">
                                真赞
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width:60px;">
                                官赞
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width:60px;">
                                官方
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width:5px;">
                                素材下载数
                            </th>
                            }
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 120px;"*@>
                                是否加精
                            </th>
                            <!--<th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 150px;"*@
                                相关科目
                            </th>-->
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 60px;"*@>
                                关联主体
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" style="width:60px;">
                                品牌
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" >
                                发布时间
                            </th>
                            <!--<th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 100px;"*@>
                                纯文字图片
                            </th>-->
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 100px;"*@>
                                用户昵称
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 100px;"*@>
                                用户手机号
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 100px;"*@>
                                审核状态
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 100px;"*@>
                                审核人
                            </th>
                            <th class="sorting" tabindex="0" aria-controls="bootstrap-data-table-export" rowspan="1" colspan="1" aria-label="Salary: activate to sort column ascending" @*style="width: 60px;">*@>
                                @*操作*@
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr role="row" class="odd" style="text-align:center;">
                                <td class="td-text-center">@item.RowNum</td>
                                <td class="td-text-center">@item.Title</td>
                                <td class="td-text-center"><div class="scale-img"><img id="image" src="@(string.IsNullOrEmpty(item.VideoCover)?item.Cover:item.VideoCover)" /></div></td>
                                <td class="td-text-center">@item.UV</td>
                                <td class="td-text-center">@item.CommentCount</td>
                                <td class="td-text-center" id="@(item.EvalId)-all">@(item.Likes+item.ShamLikes)</td>
                                @*<td class="td-text-center" id="@(item.EvalId)-real">@item.Likes</td>*@
                                @*<td class="td-text-center">
                                    <a id="@item.EvalId" href="javascript:void(0)" data-toggle="modal" text-decoration="underline" class="text-info show-shamlikes">@item.ShamLikes</a>
                                </td>*@
                                @*<td class="td-text-center">@(item.IsOfficial?"是":"否")</td>*@
                                @*<td class="td-text-center">@item.DownloadMaterialCount</td>*@
                                <td class="td-text-center">
                                    <select name="Stick" asp-for="@item.Stick" data-id="@item.EvalId" class="form-control trueoffalse">
                                        <option value="true">是</option>
                                        <option value="false">否</option>
                                    </select>
                                </td>
                                @if (false)
                                {
                                <td class="td-text-center">
                                    @*相关科目只展示，不编辑*@
                                    <label>@(item.Subjects)</label>
                                    @*@if (item.Courseid != null)//有课程，则不允许修改相关科目
                                        {
                                            @if (item.Subject == null)
                                            {
                                                <label>没科目</label>
                                            }
                                            else
                                            {
                                                <label>@(item.Subjects)</label>
                                            }
                                        }
                                        else
                                        {
                                            @if (item.Subject == null)
                                            {
                                                <select style="width:100px;" name="Subject" asp-items="@ViewBag.SubjectList" data-id="@item.EvalId" class="form-control Subject">
                                                    <option value="" disabled selected hidden>请选择</option>
                                                </select>
                                            }
                                            else
                                            {
                                                <select name="Subject" asp-for="@item.Subject" asp-items="@ViewBag.SubjectList" data-id="@item.EvalId" class="form-control Subject">
                                                </select>
                                            }
                                        }*@
                                </td>
                                }
                                @* 关联主体 *@
                            <td class="td-text-center">
                                @if (!item.ListCourses.Any() && !item.ListOrgs.Any())
                                {
                                    <label>暂无关联</label>
                                }
                                else if (item.ListCourses.Any())
                                {
                                    foreach (var cc in item.ListCourses)
                                    {
                                        <a href="@Url.Action("AddUpdateShow", "Courses", new { id = cc.CourseId })" data-id="@cc.CourseId" title="@cc.CourseTitle" class="btn btn-link">
                                            @(cc.CourseTitle.Length > 5 ? cc.CourseTitle.Substring(0, 4) + "..." : cc.CourseTitle)
                                        </a>
                                    }
                                }
                                else if (item.ListOrgs.Any())
                                {
                                    foreach (var cc in item.ListOrgs)
                                    {
                                        <a href="@Url.Action("AddOrEditOrg", "Organization", new { orgid = cc.OrgId })" data-id="@cc.OrgId" title="@cc.OrgName" class="btn btn-link">
                                            @(cc.OrgName.Length > 5 ? cc.OrgName.Substring(0, 4) + "..." : cc.OrgName)
                                        </a>
                                    }
                                }
                            </td>
                                @* 品牌 *@
                            <td class="td-text-center">
                                @if (!item.ListCourses.Any() && !item.ListOrgs.Any())
                                {
                                    <label>暂无关联</label>
                                }
                                else if (item.ListCourses.Any())
                                {
                                    foreach (var cc in item.ListCourses)
                                    {
                                        <label>@(cc.OrgName)</label>
                                    }
                                }
                                else if (item.ListOrgs.Any())
                                {
                                    foreach (var cc in item.ListOrgs)
                                    {
                                        <label>@(cc.OrgName)</label>
                                    }
                                }
                            </td>
                                @*<td class="td-text-center">
                                    <select name="IsPlaintext" asp-for="@item.IsPlaintext" data-id="@item.EvalId" class="form-control trueoffalse">
                                        <option value="true">是</option>
                                        <option value="false">否</option>
                                    </select>
                                </td>*@
                                <td style="width:120px;">@($"{item.CreateTime.ToString("yyyy-MM-dd")}\n{item.CreateTime.ToString("HH:mm:ss")}")</td>
                                <td><a href="javascript:onsearchByAuditorName('@item.NickName')" class="btn-link">@item.NickName</a></td>
                                <td>@item.Mobile</td>
                                <td>@(item.AuditStatus == 1 ? "审核通过": item.AuditStatus == 2 ? "审核不通过" : "--")</td>
                                <!--<td class="td-text-center">
                                    <a href="javascript:void(0)" text-decoration="underline" class="text-info userid">@item.UserId</a>-->
                                    @*<label class="userid">@item.UserId</label>*@
                                <!--</td>-->
                                <td>@item.AuditorName</td>
                                <td class="td-text-center">
                                    <a href="@Url.Action("EvltEditShow", new { id = item.EvalId ,queryJson = ViewBag.queryJson,page=ViewBag.page})" data-id="@item.EvalId" class="btn btn-link">编辑</a>
                                    <br />
                                    <a href="javascript:void(0)" data-id="@item.EvalId" data-status="@item.Status" class="btn btn-link" onclick="OnOfOffTheShelf(this)">@(item.Status == 1?"下架":"上架")</a>
                                    <br />
                                    <a a-auditwin="1" href="javascript:void(0)" data-id="@item.EvalId" data-userId="@item.UserId" data-nickName="@item.NickName" data-mobile="@item.Mobile" data-title="@item.Title" class="btn btn-link show-details">查看审核</a>
                                </td>
                            </tr>

                        }
                    </tbody>
                </table>
            </div>

        </div>
        @*分页*@
        <div class="row">
            @*page2、翻页时请求后台方法及传递查询参数*@
            <div class="col-sm-12 col-md-2">
                <div class="dataTables_info" id="bootstrap-data-table-export_info" role="status" aria-live="polite">
                    共@(Model.PageCount)页，@(Model.TotalItemCount)条记录
                </div>
            </div>
            <div class="col-sm-12 col-md-6">
                <div class="dataTables_paginate paging_simple_numbers" id="bootstrap-data-table-export_paginate">
                    @Html.PagedListPager(Model, page => Url.Action("Index", new
                       {
                           //左边的要与action的请求参数一致
                           page = page,
                           Subject = ((SearchEvalListQuery)ViewBag.query).Subject,
                           CourseId = ((SearchEvalListQuery)ViewBag.query).CourseId,
                           IsOfficial = ((SearchEvalListQuery)ViewBag.query).IsOfficial,
                           Stick = ((SearchEvalListQuery)ViewBag.query).Stick,
                           IsPlaintext = ((SearchEvalListQuery)ViewBag.query).IsPlaintext,
                           StartTime = ((SearchEvalListQuery)ViewBag.query).StartTime,
                           EndTime = ((SearchEvalListQuery)ViewBag.query).EndTime,
                           SearchField = ((SearchEvalListQuery)ViewBag.query).SearchField,
                           SearchFieldValue = ((SearchEvalListQuery)ViewBag.query).SearchFieldValue,
                           IsOnTheShelf = ((SearchEvalListQuery)ViewBag.query).IsOnTheShelf,
                           AuditStatus = ((SearchEvalListQuery)ViewBag.query).AuditStatus,
                           UserName = ((SearchEvalListQuery)ViewBag.query).UserName,
                           Mobile = ((SearchEvalListQuery)ViewBag.query).Mobile,
                           RelatedBody = ((SearchEvalListQuery)ViewBag.query).RelatedBody,
                       }),
                       new X.PagedList.Mvc.Common.PagedListRenderOptionsBase
                       {
                           ContainerDivClasses = new[] { "" },
                           LiElementClasses = new[] { "page-item", "paginate_button" },
                           PageClasses = new[] { "page-link" },
                           MaximumPageNumbersToDisplay = 5,
                       })
                </div>
            </div>
            <div class="col-sm-12 col-md-4">
                <div style="margin:0 1em;">
                    @Html.PagedListGoToPageForm(Model, Url.Action("Index", new
               {
                   Subject = ((SearchEvalListQuery)ViewBag.query).Subject,
                   CourseId = ((SearchEvalListQuery)ViewBag.query).CourseId,
                   IsOfficial = ((SearchEvalListQuery)ViewBag.query).IsOfficial,
                   Stick = ((SearchEvalListQuery)ViewBag.query).Stick,
                   IsPlaintext = ((SearchEvalListQuery)ViewBag.query).IsPlaintext,
                   StartTime = ((SearchEvalListQuery)ViewBag.query).StartTime,
                   EndTime = ((SearchEvalListQuery)ViewBag.query).EndTime,
                   SearchField = ((SearchEvalListQuery)ViewBag.query).SearchField,
                   SearchFieldValue = ((SearchEvalListQuery)ViewBag.query).SearchFieldValue,
                   IsOnTheShelf = ((SearchEvalListQuery)ViewBag.query).IsOnTheShelf,
                   AuditStatus = ((SearchEvalListQuery)ViewBag.query).AuditStatus,
                   UserName = ((SearchEvalListQuery)ViewBag.query).UserName,
                   Mobile = ((SearchEvalListQuery)ViewBag.query).Mobile,
                   RelatedBody = ((SearchEvalListQuery)ViewBag.query).RelatedBody,
               }), new GoToFormRenderOptions
               {
                   InputFieldName = "page",
                   InputFieldType = "number",
                   InputFieldClass = "inline-form-control",
                   InputWidth = 70,
                   LabelFormat = " 转到",
                   SubmitButtonFormat = "确定",
                   SubmitButtonClass = "btn btn-primary btn-sm btn-pager-skip",
                   SubmitButtonWidth = 50,
               })
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="hide_query" value="@ViewBag.queryJson" />
</div>

@*需要预定义ue编辑器*@
<div class="border uecontent" id="preUE" hidden="hidden" placeholder="(提示:请录入图片和文字材料)" style="min-height:50px">
    <script id="editor1" type="text/plain" style="width:100%;height:200px;">
    </script>
</div>
<pre style="display:none;" id="tmp_Meal">@Html.Raw("")</pre>

@*官方点赞数模态窗体*@
<!-- 按钮触发模态框 -->
@*<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal"></button>*@
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">
                    修改官方点赞数
                </h4>
            </div>
            <div class="modal-body">
                <div class="form-inline">
                    <label>输入点赞数：</label><input type="text" class="form-control" name="u-shamlikes" id="u-shamlikes" data-evltId="" />
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="save-shamlikes">确定</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>

            </div>
        </div>
    </div>
</div>
<script type="text/template" id="tmpl_auditfail_win">
    <div id="div_auditfail_win" class="form-group row">
        <div>
            <textarea rows="4" cols="60"></textarea>
        </div>
    </div>
</script>

@section Scripts{

    @*搜索复选下拉框*@
    @*<script src="~/js/jqselect/jquery.min.js"></script>
        <script src="~/js/jqselect/select.js"></script>*@

    <script src="@(ViewBag.StaticFile)/moment.js/2.18.1/moment-with-locales.min.js"></script>
    <script src="@(ViewBag.StaticFile)/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
    <script src="@(ViewBag.StaticFile)/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.min.js"></script>

    @*editor 富文本编辑器*@
    <script type="text/javascript" charset="utf-8" src="~/ueditor/ueditor.config.nostyle4cccv1.js"></script>
    <script type="text/javascript" charset="utf-8" src="~/ueditor/editor_api.js"></script>


    <script type="text/javascript">


         //ue编辑器
        var ue = UE.getEditor('editor1', {
            configPath: 'ueditor/config.json',
            initialContent: "",
            theme: 'tt',
            elementPathEnabled: !1,
            imageScaleEnabled: !1,
            imagePopup: !1,
            tableDragable: !1,
            wordCount: !1,
            autoHeight: false,
            toolbars: [["source", "h2", "bold", "underline", "italic", "strikethrough", "forecolor", "blockquote", "horizontal", "justifyleft", "justifycenter", "justifyright", "link", "unlink", "|", "insertimage", "|", "selectall", "removeformat", "undo", "redo"]],
            removeFormatTags: "b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,blockquote,h1,h2,h3,h4,h5,h6",
            autotypeset:
            {
                mergeEmptyline: !0,
                removeClass: !1,
                removeEmptyline: !0,
                pasteFilter: !0,
                clearFontSize: !0,
                clearFontFamily: !0
            },
        });
        ue.ready(function () {
            jQuery(this.container).click(function (e) {
                e.stopPropagation()
            });
            ue.execCommand('serverparam', 'contentID', '');
            ue.execCommand('serverparam', 'contentType', 'school_v3');
            ue.execCommand('cleardoc');
            ue.execCommand("insertHtml", '');
            //用于跳转判断
            isInit = true;
            ue.setContent(jQuery('#tmp_Meal').html());
        });
        jQuery('.uecontent').click(function (e) {
            e.stopPropagation();
            var jQuerytarget = jQuery(this);
            //解决多个ueditor切换后工具栏和输入框分离
            jQuery('.edui-editor-toolbarbox').attr('style', '');
            var content = jQuerytarget.html();
            var currentParnet = ue.container.parentNode.parentNode;
            var currentContent = ue.getContent();
            jQuerytarget.html('');
            jQuerytarget.append(ue.container.parentNode);
            ue.reset();
            setTimeout(function () {
                //用于跳转判断
                isInit = true;
                ue.setContent(content);
            }, 200)
            jQuery(currentParnet).html(currentContent);
            return false;
        });
        (function (b) {
            ue.ready(function () {
                if (b) return;
                b = true, bind_toolbar_event();
            });
            function bind_toolbar_event() {
                //ue 清除格式事件
                jQuery('.edui-editor').on('click', '.edui-for-removeformat', function () {
                    //用于跳转判断
                    isInit = true;
                    ue.setContent(rmStyle(ue.getContent()));
                });
            }
        })();


        jQuery(function () {
            jQuery('a[a-href]').on('click', function () {
                window.location.href = jQuery(this).attr('a-href');
            });

            //时间
            var datetime = (function () {

                jQuery('.datetimepicker4').datetimepicker({
                    format: 'YYYY-MM-DD',
                    locale: moment.locale('zh-cn')
                }).bind('dp.change', function (e) {
                    var d = new Date(e.date);
                    var timeId = jQuery(this).attr("id")
                    var time = jQuery(this).val();
                    if (timeId == "StartTime") {//设置结束时间的最小值为开始时间
                        jQuery("#EndTime").data("DateTimePicker").minDate(time);

                    } else if (timeId == "EndTime") {//设置开始时间的最大值为结束时间
                        jQuery("#StartTime").data("DateTimePicker").maxDate(time);

                    }
                });



            })();

            //初始化
            init();

            // change-加精--纯文字图片
            jQuery(".trueoffalse").on("change", function () {
                var sel = jQuery(this);
                var value = sel.val();
                var field = sel.attr("name");
                var id = jQuery(this).attr("data-id")
                var fieldandvalue = field + "&" + value;
                Loading("正在更新数据！");
                jQuery.post("@Url.Action("EditFiel")", { "id": id, "fieldandvalue": fieldandvalue }, function (data) {
                    if (data.status = 200) {
                        ShowAlert('操作成功', 1000, function () {
                            window.location.reload();
                        });
                    }
                    else {
                        ShowAlert(data.msg);
                        CloseLoading();
                    }
                });
            })

            //Subject
            jQuery(".Subject").on("change", function () {
                var sel = jQuery(this);
                var value = sel.val();
                var id = jQuery(this).attr("data-id")
                Loading("正在更新数据！");
                jQuery.post("@Url.Action("UpdateSubject")", { "id": id, "subject": value }, function (data) {

                    if (data.status = 200) {
                        ShowAlert('操作成功', 1000, function () {
                            window.location.reload();

                        });
                    }
                    else {
                        ShowAlert(data.msg);
                        CloseLoading();
                    }
                });
            })

             //弹框-查看审批
            jQuery('[a-auditwin]').on("click", function () {
                Loading("努力加载中...");
                var id = jQuery(this).attr('data-id');
                var userId = jQuery(this).attr('data-userId');
                var nickName = jQuery(this).attr('data-nickName');
                var mobile = jQuery(this).attr('data-mobile');
                var json = { "id": id, "userId": userId, "nickName": nickName, "mobile": mobile };

                jQuery.get("@Url.Action("Indexwin")", json, function (data) {
                    //初始化时加载标签页面
                    jQuery('#gameContainer').html(data);
                    jQuery('#gameModal').modal('show');

                    //审核通过
                    jQuery("#pass").on('click', function () {
                        var reward = parseFloat(prompt('请输入奖励金额（10元以内） * 网课种草自动双倍发放'));
                        if (reward >= 0 && reward <= 10) {
                            json.reward = reward;
                            showConfirm('确定审核通过发放奖励？', function () {
                                Loading("正在更新数据！");
                                jQuery.post("@Url.Action("EvltRewarPassAudit")", { "id": json.id, "userId": json.userId, "reward": json.reward }, function (data) {
                                    debugger;
                                    jQuery('#gameModal').modal('hide');
                                    if (data.status == 200) {
                                        ShowAlert("操作成功", 1000, function () {
                                            window.location.reload();
                                        });

                                    } else {
                                        ShowAlert(data.msg);
                                    }
                                    CloseLoading();

                                });
                            });
                        } else {
                            alert('输入的奖励金额不正确');
                        }
                    });

                    //审核不通过
                    jQuery("#unpass").on('click', function () {
                        HuLyegaJS.win({
                            title: '不通过原因',
                            width: 450,
                            height: 300,
                            autoDispose: true,
                            body: jQuery('#tmpl_auditfail_win').html(),
                            onshow: function () {
                                HuLyegaJS.openLoading('#gameModal');
                                var win = this;
                                win.ele.find('.btn_yes').on('click', function () { onAuditFail(win) });
                            },
                            onclosed: function () {
                                HuLyegaJS.closeLoading('#gameModal');
                            }
                        });
                        function onAuditFail(win) {
                            var txt = jQuery('#div_auditfail_win').find('textarea').val();
                            if (!txt) {
                                return ShowAlert('请填写不通过原因', -1);
                            }
                            showConfirm('确定审核不通过？', function () {
                                Loading("正在更新数据！");
                                jQuery.post("@Url.Action("EvltRewardUnPassAudit")", { "id": json.id, "userId": json.userId, 'auditRecord': txt }, function (data) {
                                    jQuery('#gameModal').modal('hide');
                                    if (data.status == 200) {
                                        win._done = true;
                                        win.close(), ShowAlert("操作成功", 1000, function () {                                            
                                            window.location.reload();
                                        });
                                    } else {
                                        ShowAlert(data.msg);
                                    }
                                    CloseLoading();                                    
                                });
                            });
                        }
                    });

                    CloseLoading();
                });
            });

            //修改点赞数
            var shamlikes = (function () {

                //弹框
                jQuery(".show-shamlikes").on("click", function () {
                    var $a = jQuery(this);
                    jQuery("#u-shamlikes").val($a.text()).attr("data-evltId", $a.attr("id"));
                    jQuery('#myModal').modal('show');
                });

                //保存
                jQuery("#save-shamlikes").on("click", function () {
                    showConfirm('确定要更新此评测的官方点赞数？', function () {
                        Loading("正在更新数据！");
                        var $input = jQuery("#u-shamlikes");
                        var evltId = $input.attr("data-evltId");
                        var shamLikes = parseInt($input.val());
                        jQuery.post("@Url.Action("UpdateEvltShamLikes")", { "id": evltId, "shamLikes": shamLikes }, function (data) {

                            if (data.status == 200) {
                                ShowAlert('操作成功', 1000, function () {

                                    //更新总赞\官赞展示即可
                                    jQuery("#" + evltId).text(shamLikes);//官赞
                                    var real = parseInt(jQuery("#" + evltId + "-real").text()) //真赞
                                    jQuery("#" + evltId + "-all").text(shamLikes + real );//总赞
                                    CloseLoading();
                                    //window.location.reload();
                                });
                            } else {
                                ShowAlert(data.msg);
                                CloseLoading();
                            }
                        });
                    });
                    jQuery('#myModal').modal('hide')
                });
            })();

            //作者自动查询
            var autoSearch = (function () {
                jQuery(".userid").on("click", function () {
                    jQuery("#SearchField").val("userid");//选中作者
                    jQuery("#SearchFieldValue").val(jQuery(this).text())//内容框赋值作者
                    jQuery("#search").click();
                });
            })()

            //page1、 page skip get searchdata from FormTable
            jQuery('.btn-pager-skip').on('click', function () {

                initSearchParments();
                var form = jQuery(this).parents('form').eq(0), u = form.attr('action');
                if (u.indexOf('?') > -1) {
                    window.location.href = u + '&page=' + form.find('[name=page]').val();
                }
                else {
                    window.location.href = u + '?page=' + form.find('[name=page]').val();
                }

                return false;
            });

            //科目--课程关联查询
            var linkSearch = (function () {
                jQuery("#Subject").on("change", function () {
                    var subjectid = parseInt(jQuery(this).val());//科目id
                    InstCourseSelect(subjectid);
                })
                function InstCourseSelect(subjectid) {
                    if (subjectid > 0) {
                        var selectvalue = (JSON.parse(jQuery("#hide_query").val())).CourseId;
                        var html = "";
                        html += '<option value="" disabled selected hidden>请选择</option>   ';
                        html += '    <option value="null">所有</option>';
                        jQuery.getJSON('@Url.Action("GetCoursesBySubjectId", "Courses")', { "subjectid": subjectid }, function (res) {
                            if (res != null) {
                                jQuery(res).each(function (index, item) {
                                    if (selectvalue == item.id) {
                                        html += '    <option selected="selected" value="' + item.id + '" >' + item.title + '</option>';
                                    } else {
                                        html += '    <option value="' + item.id + '">' + item.title + '</option>';
                                    }

                                });

                                jQuery("#CourseId option").remove();
                                jQuery("#CourseId").append(html);
                            }
                        });
                    }
                }
                InstCourseSelect(jQuery("#Subject").val());

            })();

        })

        //点赞数控制为正整数
        HuLyegaJS.decimalInput({
            ele: '[name="u-shamlikes"]',
            decimalPlaces:0
        });

        //jQuery('.datetimepicker4').datetimepicker({
        //    format: 'YYYY-MM-DD',
        //    locale: moment.locale('zh-cn')
        //});

        function init() {

        initSearchParments();

        var action = jQuery(".PagedList-goToPage").attr("action");
        jQuery(".PagedList-goToPage").attr("action", action);

    }

            function initSearchParments() {
                //1、获取查询hide json值
                var queryjson = JSON.parse(jQuery("#hide_query").val());



                //2、把查询条件的值赋值给相应查询框

                if (queryjson.AuditStatus != null) {
                    jQuery("#AuditStatus").val("" + queryjson.AuditStatus);
                }
                if (queryjson.IsOfficial != null) {
                    jQuery("#IsOfficial").val("" + queryjson.IsOfficial);
                }
                if (queryjson.Subject != null) {
                    jQuery("#Subject").val("" + queryjson.Subject);
                }

                if (queryjson.CourseId != null) {
                    jQuery("#CourseId").val(queryjson.CourseId);
                }
                if (queryjson.Stick != null) {
                    jQuery("#Stick").val("" + queryjson.Stick);
                }
                if (queryjson.IsPlaintext != null) {
                    jQuery("#IsPlaintext").val("" + queryjson.IsPlaintext);
                }
                if (queryjson.StartTime != null) {
                    jQuery("#StartTime").val("@(((SearchEvalListQuery)ViewBag.query).StartTime!=null? ((SearchEvalListQuery)ViewBag.query).StartTime.Value.ToString("yyyy-MM-dd"):"")");
                }
                if (queryjson.EndTime != null) {
                    jQuery("#EndTime").val("@(((SearchEvalListQuery)ViewBag.query).EndTime!=null? ((SearchEvalListQuery)ViewBag.query).EndTime.Value.ToString("yyyy-MM-dd"):"")");
                }
                if (queryjson.SearchField != null && queryjson.SearchField != "") {
                    jQuery("#SearchField").val(queryjson.SearchField);
                    jQuery("#SearchFieldValue").val(queryjson.SearchFieldValue);
                }
                if (queryjson.IsOnTheShelf != null) {//上架状态
                    jQuery("#IsOnTheShelf").val("" + queryjson.IsOnTheShelf);
                }

                if (queryjson.Mobile != null) {
                    jQuery('#Mobile').val('' + queryjson.Mobile);
                }
                if (queryjson.UserName != null) {
                    jQuery('#UserName').val('' + queryjson.UserName);
                }
                if (queryjson.RelatedBody) {
                    jQuery('#RelatedBody').val('' + queryjson.RelatedBody);
                }
            }

        function onsearchByAuditorName(userame) {
            window.location.href = '@Url.Action()' + '?UserName=' + userame;
        }


    //上/下架
    function OnOfOffTheShelf(select) {
        var $this = jQuery(select);
        var id = $this.attr("data-id");
        var status = $this.attr("data-status");
        showConfirm(status == "1" ? '确定要下架此评测？' :'确定要上架此评测？', function () {
            Loading("正在更新数据！");
                jQuery.post("@Url.Action("OffOrOnTheShelf")", { "id": id, "status": status }, function (data) {

                    if (data.status == 200) {
                    ShowAlert('操作成功', 1000, function () {
                        window.location.reload();
                    });
                    } else {
                        ShowAlert(data.msg);
                        CloseLoading();
                }
            });
        });
        }


    //鼠标移上去放大图片
    function moveover() {
        document.getElementById('image').width = "200"
        document.getElementById('image').height = "360"
        }
    //鼠标离开恢复图片大小
    function moveback() {
        document.getElementById('image').width = "150"
        document.getElementById('image').height = "10"
    }



    </script>
}
